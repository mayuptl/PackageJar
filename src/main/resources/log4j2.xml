<?xml version="1.0" encoding="UTF-8"?>
<!--
    The shutdownHook="disable" is added to prevent Log4j from delaying the JVM shutdown
    and to allow the WebDriver processes to terminate cleanly, which is common in test automation.
-->
<Configuration status="WARN" debug="false" shutdownHook="disable">
    <!-- Changing status to WARN to suppress unnecessary Log4j internal output -->
    <Properties>
        <Property name="CONSOLE_PATTERN">%d{yyyy-MM-dd HH:mm:ss} [%X{driverId}] %highlight{[%p]}{ERROR=red, WARN=yellow bold, INFO=green, DEBUG=blue, TRACE=blue} %c{1} - %msg%n</Property>
        <Property name="FILE_PATTERN">%d{yyyy-MM-dd HH:mm:ss} [%X{driverId}] [%p] %c{1} - %msg%n</Property>

        <!-- Define the base logging directory -->
        <!-- ${sys:user.dir} points to D:\Work\Automation\app-utils\app-utils\target\classes when running tests -->
        <Property name="LOG_DIR">${sys:log4j2.logDir}</Property>
        <Property name="LOG_FILE_NAME">${sys:log4j2.logDir}/${sys:log4j2.fileName}</Property>
        <!--<Property name="LOG_DIR">execution-output/test-logs</Property>
        <Property name="LOG_FILE_NAME">${LOG_DIR}/Logs.log</Property>-->
    </Properties>

    <Appenders>
        <!-- Console Appender (STDOUT) -->
        <Console name="STDOUT" target="SYSTEM_OUT">
            <PatternLayout pattern="${CONSOLE_PATTERN}" />
        </Console>

        <!-- Rolling File Appender (Recommended for stability and automatic directory creation) -->
        <!-- The RollingFile appender is generally more robust and flexible for logging to files. -->
        <!-- Log4j 2 uses the `filePermissions` attribute to attempt to ensure file creation. -->
        <RollingFile name="FileAppender"
                     fileName="${sys:log4j2.logDir}/${sys:log4j2.fileName}"
                     filePattern="${sys:log4j2.logDir}/archive/Logs-%d{yyyy-MM-dd}-%i.log.gz"
                     createOnDemand="true">
            <PatternLayout pattern="${FILE_PATTERN}" />

            <!-- Standard Rolling Policy (This ensures the logs don't grow indefinitely) -->
            <Policies>
                <OnStartupTriggeringPolicy />
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="10 MB"/>
            </Policies>
            <!-- Default Rollover Strategy -->
            <DefaultRolloverStrategy max="20" />
        </RollingFile>
    </Appenders>

    <!-- Loggers Configuration -->
    <Loggers>
        <!-- Suppress verbose Log4j 2 status messages below WARN -->
        <Root level="info">
            <AppenderRef ref="STDOUT" />
            <AppenderRef ref="FileAppender" />
        </Root>
    </Loggers>
</Configuration>
